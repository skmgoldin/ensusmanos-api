AWSTemplateFormatVersion: 2010-09-09

Parameters:
  RepositoryName:
    Type: String
  ECRLifecyclePolicy:
    Type: String
    Default:
      '
        {
          "rules": [
            {
              "rulePriority": 1,
              "description": "delete EXPIRED images after three days",
              "selection": {
                "tagStatus": "tagged",
                "tagPrefixList": [
                  "EXPIRED"
                ],
                "countType": "sinceImagePushed",
                "countUnit": "days",
                "countNumber": 3
              },
              "action": {
                "type": "expire"
              }
            }
          ]
        }
      '

Resources:
  ImageRepository:
    Type: AWS::ECR::Repository
    Properties: 
      RepositoryName: !Ref RepositoryName
      LifecyclePolicy:
        LifecyclePolicyText: !Ref ECRLifecyclePolicy

Outputs:
  ImageRepository:
    Value: !Ref ImageRepository

